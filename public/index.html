<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/MozillaReality/ammo.js@8bbc0ea/builds/ammo.wasm.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.js"></script>
    
    <title>Pottery VR</title>
    <link rel="stylesheet" href="css/styles.css"/>
    <script src="scripts/pickup-pottery.js"></script>
    <script src="scripts/manager.js"></script>
    <script src="scripts/place-piece.js"></script>
    <script src="scripts/potteryPieceModification.js"></script>
    <script src="scripts/wheel-spin.js"></script>
    <script src="scripts/constants.js"></script>
    <script src="scripts/create-pottery.js"></script>
    <script src="scripts/throw-piece.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-particle-system-component@1.2.0/dist/aframe-particle-system-component.min.js"></script>
    
    <script>
        
        //create a component that will represent the pottery piece
        AFRAME.registerComponent("pottery-modification", {
            schema: {
                radiusTop: {type: "number", default: 0.5},
                radiusBottom: {type: "number", default: 0.5},
                height: {type: "number", default: 1},
                thickness: {type: "number", default: 0.02}
            },
            init: function () {
                var data = this.data    //get the component properties and their values
                var el = this.el        //get the element the component is attached to 
            }
        })

        AFRAME.registerComponent("radius-slider", {
            schema: {
                dragging: {type: "boolean", default: "false"}
            },
            init: function() {
                console.log(this.data)

                //listen for when the radius changes
                this.el.addEventListener("mousedown", function(event) {
                    console.log(event)
                    event.srcElement.setAttribute("radius-slider", "dragging: true")
                })

                this.el.addEventListener("mouseup", function(event) {
                    console.log(event)
                    event.srcElement.setAttribute("radius-slider", "dragging: false")
                })
            },
            update: function(oldData) {
                console.log(this.data)
            }
        })

        AFRAME.registerComponent("collide", {
            init: function() {
                this.el.addEventListener("obbcollisionstarted", () => {
                    console.log("we are colliding");
                })
            }
        })
        
       
    </script>
</head>
<body>
    <div id="sliders-overlay" style="display: none;">
        <input onclick="printHello()"/>
        <input id="slider1" type="range" min="0" max="1" step="0.01" value="0" style="width: 200px" oninput="taperTop(event)"/>
        <input id="slider2" type="range" min="0" max="1" step="0.01" value="0" style="width: 200px" oninput="taperBottom(event)"/>
        <input id="slider3" type="range" min="0" max="0.5" step="0.01" value="0" style="width: 200px" oninput="adjustHeight(event)"/>
    </div>
    
    <a-scene obb-collider="showColliders: false"  id="scene" physics="driver: ammo; debug: true; debugDrawMode: 1;">
        <!-- loading in the assets -->
        <a-assets timeOut="10000">
            <a-asset-item id="wheel_model" response-type="arraybuffer" src="assets/models/wheel/PBR - Metallic Roughness Alpha-blend.glb"></a-asset-item>
            <a-asset-item id="clay_model" response-type="arraybuffer" src="assets/models/clay/PBR - Metallic Roughness Alpha-blend.glb"></a-asset-item>
            <img id="test" src="assets/testTexture.png" crossorigin="anonymous"/>
        </a-assets>
        <a-entity id="camera" camera wasd-controls look-controls position="0 1.6 4">
            <a-entity id="collider2"  obb-collider="size: 1 1 1" ></a-entity>
            <a-entity id="cursor" cursor="rayOrigin:mouse;" raycaster="far:20; interval:200; objects:.interactive"></a-entity>
        </a-entity>

        <a-entity id="manager" manager></a-entity>
        <a-entity>
            <a-entity geometry="primitive: box" id="shelf" class="interactive"
               position="4 0 0"
               scale="6 2 2">
            </a-entity>
            <a-entity id="collider1"  obb-collider="size: 1 1 1" position="4 1.6 2"></a-entity>
            
        </a-entity>

        <!-- <a-entity rotation="-90 0 0" position="5 5 -10">
            <a-entity particle-system=" type: 3; dragValue: 1; maxAge: 0.4; size: 1; particleCount: 10;  duration: 0.2; velocitySpread: 2 2 2; accelerationValue:-10, -50, -10; velocityValue: 2 10 2; color: #80663b, #c7ad99; blending: 1; texture: assets/textures/triangle.png"></a-entity>
        </a-entity> -->
        
        
        <a-plane id="wall" class="interactive" emitCollisionEvents="true" ammo-body="type: static" ammo-shape="type: box" material="side: double; color: grey;" rotation="0 0 0" scale="20 20 20" position="0 0 -10"></a-plane>
        <a-plane id="plane" class="interactive"  emitCollisionEvents="true" ammo-body="type: static" ammo-shape="type: box" scale="20 20 20" material="color: #989ea6" rotation="-90 0 0"></a-plane>
        <a-box class="interactive"  id="boxTest" box-throw position="0 2 4"></a-box>
        <a-cylinder id="button" class="interactive" position="-4 0 -4" scale="1 1 1" color="red" wheel-spin></a-cylinder>
        <a-entity position="0 0 -4">
            <a-cylinder position="0 0.3 0"
                        scale="1.9 0.6 1.9"
                        material="color: blue; side:double"
                        open-ended="true">
            </a-cylinder>
            <a-entity id="wheel-spin"
                      animation="property: rotation; loop:true; dur:1000; easing:linear; enabled: false">
                        <a-cylinder
                            position="0 0.05 0"
                            scale="1.7 0.1 1.7"
                            material="src: #test">
                        </a-cylinder>
                        <!-- <a-entity id="pottery-piece" position="0 0.11 -4" scale="1 1 1">
                            <a-cone id="outer-cone"
                                radius-bottom="0.5"
                                radius-top=".5"
                                height="1.4"
                                position="0 0.7 0"
                                open-ended="true">
                            </a-cone>
                            <a-cone id="inner-cone"
                                    radius-bottom="0.4"
                                    radius-top="0.4"
                                    height="1.4"
                                    position="0 0.7 0"
                                    material="side:double"
                                    open-ended="true">
                            </a-cone>
                            <a-ring id="top-ring"
                                    rotation="90 0 0"
                                    material="side:double"
                                    radius-outer="0.5"
                                    radius-inner="0.4"
                                    segments-theta="36"
                                    position="0 1.4 0">
                            </a-ring>
                            <a-ring id="bottom-ring"
                                    rotation="90 0 0"
                                    material="side:double"
                                    radius-outer="0.5"
                                    radius-inner="0.4"
                                    segments-theta="36"
                                    position="0 0 0">
                            </a-ring>
                            <a-ring id="bottom ring"
                                    position="0 -0.5 0"
                                    rotation="90 0 0 "
                                    radius-outer="0.7"
                                    radius-inner="0.6"
                                    material="side: double; color: green">
                                <a-sphere class="interactive"
                                          id="sphere"
                                          position="1 0 0"
                                          scale="0.2 0.2 0.2"
                                          material="color: green"
                                          radius-slider>
                                </a-sphere>
                            </a-ring>
                        </a-entity> -->
            </a-entity>
        </a-entity>

        <a-entity id="wheel" position="0 0 0" rotation="0 0 0" scale="30 30 30" gltf-model="#wheel_model"></a-entity>
        <a-entity id="clay" position="0 0 0" rotation="0 0 0" scale="100 100 100" gltf-model="#clay_model"></a-entity>
        <a-box class="interactive"
                position="4 0 -4"
                material="color: #8a7969"
                create-pottery>
        </a-box>
        
        

    </a-scene>
</body>
</html>