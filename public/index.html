<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/MozillaReality/ammo.js@8bbc0ea/builds/ammo.wasm.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.js"></script>
    
    <title>Pottery VR</title>
    <link rel="stylesheet" href="css/styles.css"/>
    <script src="scripts/pickup-pottery.js"></script>
    <script src="scripts/manager.js"></script>
    <script src="scripts/place-piece.js"></script>
    <script src="scripts/potteryPieceModification.js"></script>
    <script src="scripts/wheel-spin.js"></script>
    <script src="scripts/constants.js"></script>
    <script src="scripts/create-pottery.js"></script>
    <script src="scripts/throw-piece.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-particle-system-component@1.2.0/dist/aframe-particle-system-component.min.js"></script>
    
    <script>
        
        //create a component that will represent the pottery piece
        AFRAME.registerComponent("pottery-modification", {
            schema: {
                radiusTop: {type: "number", default: 0.5},
                radiusBottom: {type: "number", default: 0.5},
                height: {type: "number", default: 1},
                thickness: {type: "number", default: 0.02}
            },
            init: function () {
                var data = this.data    //get the component properties and their values
                var el = this.el        //get the element the component is attached to 
            }
        })

        AFRAME.registerComponent("radius-slider", {
            schema: {
                dragging: {type: "boolean", default: "false"}
            },
            init: function() {
                console.log(this.data)

                //listen for when the radius changes
                this.el.addEventListener("mousedown", function(event) {
                    console.log(event)
                    event.srcElement.setAttribute("radius-slider", "dragging: true")
                })

                this.el.addEventListener("mouseup", function(event) {
                    console.log(event)
                    event.srcElement.setAttribute("radius-slider", "dragging: false")
                })
            },
            update: function(oldData) {
                console.log(this.data)
            }
        })

        
       
    </script>
</head>
<body>
    <div id="sliders-overlay" style="display: none;">
        <input onclick="printHello()"/>
        <input id="slider1" type="range" min="0" max="0.1" step="0.01" value="0" style="width: 200px" oninput="taperTop(event)"/>
        <input id="slider2" type="range" min="0" max="0.1" step="0.01" value="0" style="width: 200px" oninput="taperBottom(event)"/>
        <input id="slider3" type="range" min="1" max="4" step="0.1" value="1" style="width: 200px" oninput="adjustHeight(event)"/>
    </div>
    
    <a-scene obb-collider="showColliders: false"  id="scene" physics="driver: ammo; debug: true; debugDrawMode: 1;">
        <!-- loading in the assets -->
        <a-assets timeOut="10000">
            <a-asset-item id="room_model" response-type="arraybuffer" src="assets/models/room.glb"></a-asset-item>
            <a-asset-item id="scene_model" response-type="arraybuffer" src="assets/models/furniture.glb"></a-asset-item>
            <a-asset-item id="clay_model" response-type="arraybuffer" src="assets/models/clay.glb"></a-asset-item>
            <a-asset-item id="spinner_model" response-type="arraybuffer" src="assets/models/spinner/spinner.glb"></a-asset-item>
            <img id="test" src="assets/testTexture.png" crossorigin="anonymous"/>
        </a-assets>
        <a-entity id="camera" camera="zoom: 1" wasd-controls look-controls position="0 1.6 4">
            <a-entity id="collider2"  obb-collider="size: 1 1 1" ></a-entity>
            <a-entity id="cursor" cursor="rayOrigin:mouse;" raycaster="far:20; interval:200; objects:.interactive"></a-entity>
        </a-entity>

        <a-entity id="manager" manager></a-entity>
        <a-entity>
            <a-entity geometry="primitive: box; height:1" id="shelf" class="interactive"
               position="4 0 0"
               scale="6 1 2">
            </a-entity>
            <a-entity id="collider1"  obb-collider="size: 1 1 1" position="4 1.6 2"></a-entity>
            
        </a-entity>

        <!-- <a-entity rotation="-90 0 0" position="5 5 -10">
            <a-entity particle-system=" type: 3; dragValue: 1; maxAge: 0.4; size: 1; particleCount: 10;  duration: 0.2; velocitySpread: 2 2 2; accelerationValue:-10, -50, -10; velocityValue: 2 10 2; color: #80663b, #c7ad99; blending: 1; texture: assets/textures/triangle.png"></a-entity>
        </a-entity> -->
        
    
        <a-box class="interactive"  id="boxTest" emitCollisionEvents="true" ammo-body="type: dynamic" ammo-shape="type: box" position="0 2 4"></a-box>
        <a-cylinder id="button" 
                    class="interactive" 
                    position="-3.031 1 3.163" 
                    height="0.1" 
                    radius="0.08" 
                    color="#6b60be" 
                    animation="property: position; from:-3.031 0.95 3.163; to:-3.031 1 3.163; dur:200; startEvents: click;"
                    wheel-spin></a-cylinder>

        <a-box scale="1 3 1"></a-box>
        <!-- invisible geometry for colliders -->
        <a-entity id="wall-z-negative" 
                  geometry="primitive: plane; width:10.5; height: 3.7" 
                  position="0 1.7 -5.1"
                  emitCollisionEvents="true" 
                  ammo-body="type: static" 
                  ammo-shape="type: box">
        </a-entity>
        <!-- <a-entity id="wall-x-negative" 
                  geometry="primitive: plane; width:10.5; height: 3.7" 
                  position="-5.25 1.7 0"
                  rotation="0 90 0"
                  emitCollisionEvents="true" 
                  ammo-body="type: static" 
                  ammo-shape="type: box">
        </a-entity> -->
        <a-entity id="wall-z-positive" 
                  geometry="primitive: plane; width:10.5; height: 3.7" 
                  position="0 1.7 5.25"
                  rotation="0 180 0"
                  emitCollisionEvents="true" 
                  ammo-body="type: static" 
                  ammo-shape="type: box">
        </a-entity>
        <a-entity id="wall-x-positive" 
                  geometry="primitive: plane; width:10.5; height: 3.7" 
                  position="5.25 1.7 0"
                  rotation="0 270 0"
                  emitCollisionEvents="true" 
                  ammo-body="type: static" 
                  ammo-shape="type: box">
        </a-entity>
        <a-entity id="floor" 
                  geometry="primitive: plane; width:10.5; height: 10.5" 
                  position="0 0.011 0"
                  rotation="-90 0 0"
                  emitCollisionEvents="true" 
                  ammo-body="type: static" 
                  ammo-shape="type: box">
        </a-entity>
        <a-entity id="ceiling" 
                  geometry="primitive: plane; width:10.5; height: 10.5" 
                  position="0 3.7 0"
                  rotation="90 0 0"
                  emitCollisionEvents="true" 
                  ammo-body="type: static" 
                  ammo-shape="type: box">
        </a-entity>
        <a-entity class="interactive" id="room" position="0 0.01 0" rotation="0 0 0" scale="1.2 1.2 1.2" gltf-model="#room_model"></a-entity>
        <a-entity class="interactive" id="furniture" position="0 0.01 0" rotation="0 0 0" scale="1 1 1" gltf-model="#scene_model"></a-entity>
        <a-entity class="interactive" id="clay" create-pottery class="interactive" position="-3.2 0.95 2.4" rotation="0 0 0" gltf-model="#clay_model"></a-entity>
        <a-entity id="wheel-spin"
                  animation="property: rotation; loop:true; dur:1000; easing:linear; enabled: false" 
                  class="interactive" 
                  position="-3.3 0.8 2.86" 
                  rotation="0 0 0" 
                  scale="1.1 1.1 1.1" 
                  gltf-model="#spinner_model">
        </a-entity>
        
        

    </a-scene>
</body>
</html>